{"ast":null,"code":"import axios from 'axios';\nconst API_URL = 'http://localhost:8000';\nexport const fetchChatMessages = async () => {\n  try {\n    const response = await axios.get(`${API_URL}/chat/messages`);\n    return response.data;\n  } catch (error) {\n    console.error('Error fetching chat messages:', error);\n    throw error;\n  }\n};\nexport const fetchCharacters = async () => {\n  try {\n    const response = await axios.get(`${API_URL}/characters`);\n    return response.data;\n  } catch (error) {\n    console.error('Error fetching characters:', error);\n    throw error;\n  }\n};\nexport const sendMessage = async message => {\n  try {\n    const response = await axios.post(`${API_URL}/chat`, {\n      ...message,\n      user_id: message.user_id || 1 // Default to user_id 1 if not provided\n    });\n    return response.data;\n  } catch (error) {\n    console.error('Error sending message:', error);\n    throw error;\n  }\n};\nexport const streamMessage = (message, onMessage) => {\n  let retryCount = 0;\n  const MAX_RETRIES = 3;\n  const RETRY_DELAY = 1000; // 1 second\n\n  const connect = () => {\n    const params = new URLSearchParams({\n      message: message.message,\n      user_id: (message.user_id || 1).toString(),\n      ...(message.character_id && {\n        character_id: message.character_id.toString()\n      })\n    });\n    const eventSource = new EventSource(`${API_URL}/chat?${params}`);\n    let messageBuffer = '';\n    eventSource.onmessage = event => {\n      try {\n        const data = JSON.parse(event.data);\n\n        // Handle word streaming\n        if (data.text) {\n          messageBuffer += data.text + ' ';\n          onMessage({\n            text: data.text,\n            done: data.done,\n            error: data.error\n          });\n        }\n        if (data.done || data.error) {\n          eventSource.close();\n          // Send final buffered message if needed\n          if (messageBuffer.trim()) {\n            onMessage({\n              text: messageBuffer.trim(),\n              done: true\n            });\n          }\n        }\n      } catch (error) {\n        console.error('Error parsing message:', error);\n        eventSource.close();\n        onMessage({\n          text: '',\n          done: true,\n          error: 'Failed to parse response'\n        });\n      }\n    };\n    eventSource.onerror = async error => {\n      console.error('EventSource error:', error);\n      eventSource.close();\n      if (retryCount < MAX_RETRIES) {\n        retryCount++;\n        console.log(`Retrying connection (${retryCount}/${MAX_RETRIES})...`);\n        await new Promise(resolve => setTimeout(resolve, RETRY_DELAY));\n        connect();\n      } else {\n        onMessage({\n          text: '',\n          done: true,\n          error: 'Connection failed after multiple attempts. Please try again.'\n        });\n      }\n    };\n    return () => {\n      eventSource.close();\n    };\n  };\n  return connect();\n};","map":{"version":3,"names":["axios","API_URL","fetchChatMessages","response","get","data","error","console","fetchCharacters","sendMessage","message","post","user_id","streamMessage","onMessage","retryCount","MAX_RETRIES","RETRY_DELAY","connect","params","URLSearchParams","toString","character_id","eventSource","EventSource","messageBuffer","onmessage","event","JSON","parse","text","done","close","trim","onerror","log","Promise","resolve","setTimeout"],"sources":["C:/Users/ajits/fastapi-react-chatbot/frontend/src/services/api.ts"],"sourcesContent":["import axios from 'axios';\n\nconst API_URL = 'http://localhost:8000';\n\ninterface ChatMessage {\n    message: string;\n    character_id?: number;\n    user_id: number;  // Added user_id as required\n}\n\ninterface ChatResponse {\n    response: string;\n}\n\ninterface Character {\n    id: number;\n    name: string;\n    movie: string;\n    chat_style: string;\n    example_responses: string[];\n}\n\nexport interface StreamResponse {\n    text: string;\n    done: boolean;\n    error?: string;\n}\n\nexport const fetchChatMessages = async () => {\n    try {\n        const response = await axios.get(`${API_URL}/chat/messages`);\n        return response.data;\n    } catch (error) {\n        console.error('Error fetching chat messages:', error);\n        throw error;\n    }\n};\n\nexport const fetchCharacters = async (): Promise<Character[]> => {\n    try {\n        const response = await axios.get(`${API_URL}/characters`);\n        return response.data;\n    } catch (error) {\n        console.error('Error fetching characters:', error);\n        throw error;\n    }\n};\n\nexport const sendMessage = async (message: ChatMessage): Promise<ChatResponse> => {\n    try {\n        const response = await axios.post(`${API_URL}/chat`, {\n            ...message,\n            user_id: message.user_id || 1  // Default to user_id 1 if not provided\n        });\n        return response.data;\n    } catch (error) {\n        console.error('Error sending message:', error);\n        throw error;\n    }\n};\n\nexport const streamMessage = (message: ChatMessage, onMessage: (data: StreamResponse) => void) => {\n    let retryCount = 0;\n    const MAX_RETRIES = 3;\n    const RETRY_DELAY = 1000; // 1 second\n\n    const connect = () => {\n        const params = new URLSearchParams({\n            message: message.message,\n            user_id: (message.user_id || 1).toString(),\n            ...(message.character_id && { character_id: message.character_id.toString() })\n        });\n\n        const eventSource = new EventSource(`${API_URL}/chat?${params}`);\n        let messageBuffer = '';\n\n        eventSource.onmessage = (event) => {\n            try {\n                const data = JSON.parse(event.data) as StreamResponse;\n                \n                // Handle word streaming\n                if (data.text) {\n                    messageBuffer += data.text + ' ';\n                    onMessage({ \n                        text: data.text, \n                        done: data.done,\n                        error: data.error \n                    });\n                }\n                \n                if (data.done || data.error) {\n                    eventSource.close();\n                    // Send final buffered message if needed\n                    if (messageBuffer.trim()) {\n                        onMessage({ \n                            text: messageBuffer.trim(), \n                            done: true \n                        });\n                    }\n                }\n            } catch (error) {\n                console.error('Error parsing message:', error);\n                eventSource.close();\n                onMessage({ text: '', done: true, error: 'Failed to parse response' });\n            }\n        };\n\n        eventSource.onerror = async (error) => {\n            console.error('EventSource error:', error);\n            eventSource.close();\n            \n            if (retryCount < MAX_RETRIES) {\n                retryCount++;\n                console.log(`Retrying connection (${retryCount}/${MAX_RETRIES})...`);\n                await new Promise(resolve => setTimeout(resolve, RETRY_DELAY));\n                connect();\n            } else {\n                onMessage({ \n                    text: '', \n                    done: true, \n                    error: 'Connection failed after multiple attempts. Please try again.' \n                });\n            }\n        };\n\n        return () => {\n            eventSource.close();\n        };\n    };\n\n    return connect();\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}